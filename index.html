<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8"/>
  <meta name="viewport" content="width=device-width, initial-scale=1"/>
  <link rel="manifest" href="manifest.json">
  <title>Fig Ops â€” Saplings Manager</title>
  <style>
    :root{--bg:#0b132b;--card:#1c2541;--muted:#3a506b;--accent:#5bc0be;--text:#eaeaea}
    *{box-sizing:border-box}body{margin:0;background:var(--bg);color:var(--text);font-family:system-ui,-apple-system,Segoe UI,Roboto,Inter,Arial}
    header{display:flex;align-items:center;justify-content:space-between;padding:12px 16px;background:var(--card);position:sticky;top:0;z-index:10}
    header h1{font-size:18px;margin:0} header .pill{padding:6px 10px;border-radius:999px;background:var(--muted);font-size:12px}
    main{padding:16px;max-width:1100px;margin:0 auto}
    nav{display:flex;gap:8px;flex-wrap:wrap;margin-bottom:12px}
    nav button{background:var(--muted);color:var(--text);border:none;padding:10px 12px;border-radius:10px;cursor:pointer}
    nav button.active{background:var(--accent);color:#001018}
    .grid{display:grid;grid-template-columns:repeat(auto-fit,minmax(260px,1fr));gap:12px}
    .card{background:var(--card);border:1px solid #2b3555;border-radius:14px;padding:14px}
    h2{font-size:16px;margin:0 0 10px 0}
    label{font-size:12px;opacity:.9}
    input,select,textarea{width:100%;padding:10px;border-radius:10px;border:1px solid #2b3555;background:#111a33;color:var(--text);margin-top:6px}
    table{width:100%;border-collapse:collapse} th,td{padding:8px;border-bottom:1px solid #2b3555;font-size:14px}
    .row{display:flex;gap:10px;flex-wrap:wrap}
    .row > *{flex:1 1 200px}
    .badge{padding:3px 8px;border-radius:999px;background:#0f203f;border:1px solid #2b3555;font-size:12px}
    .hint{font-size:12px;opacity:.8}
    footer{opacity:.7;font-size:12px;padding:24px;text-align:center}
    canvas{background:#0f1a34;border-radius:12px;padding:8px}
  </style>
</head>
<body>
  <header>
    <h1>ðŸŒ³ Fig Ops â€” Saplings Manager</h1>
    <span class="pill" id="syncStatus">offline</span>
  </header>

  <main>
    <nav>
      <button data-tab="dashboard" class="active">Dashboard</button>
      <button data-tab="lots">Lots</button>
      <button data-tab="orders">Orders</button>
      <button data-tab="customers">Customers</button>
      <button data-tab="analytics">Analytics</button>
      <button data-tab="settings">Settings</button>
    </nav>

    <section id="dashboard" class="tab">
      <div class="grid">
        <div class="card">
          <h2>KPIs (last 30 days)</h2>
          <div class="row">
            <div><div class="hint">Rooting Success %</div><div id="kpi_rooting" class="badge"></div></div>
            <div><div class="hint">Delivery Success %</div><div id="kpi_delivery" class="badge"></div></div>
            <div><div class="hint">Return Rate %</div><div id="kpi_returns" class="badge"></div></div>
            <div><div class="hint">Orders</div><div id="kpi_orders" class="badge"></div></div>
          </div>
        </div>
        <div class="card">
          <h2>Todayâ€™s Actions</h2>
          <ul id="todo"></ul>
        </div>
        <div class="card">
          <h2>Live Chart â€” Orders</h2>
          <canvas id="ordersChart" height="160"></canvas>
        </div>
      </div>
    </section>

    <section id="lots" class="tab" hidden>
      <div class="card">
        <h2>New Lot</h2>
        <div class="row">
          <div><label>Variety<select id="lot_variety"></select></label></div>
          <div><label>Method<select id="lot_method"><option>short-node</option><option>air-layer</option><option>graft</option></select></label></div>
          <div><label>Quantity<input id="lot_qty" type="number" min="1" value="20"></label></div>
          <div><label>Start Date<input id="lot_start" type="date"></label></div>
        </div>
        <button id="addLotBtn">Add Lot</button>
      </div>
      <div class="card">
        <h2>Lots</h2>
        <table id="lotsTable"><thead><tr><th>Lot ID</th><th>Variety</th><th>Method</th><th>Qty</th><th>Start</th><th>Stage</th><th>Success %</th></tr></thead><tbody></tbody></table>
      </div>
    </section>

    <section id="orders" class="tab" hidden>
      <div class="card">
        <h2>New Order</h2>
        <div class="row">
          <div><label>Customer<select id="order_customer"></select></label></div>
          <div><label>Variety<select id="order_variety"></select></label></div>
          <div><label>Qty<input id="order_qty" type="number" min="1" value="1"></label></div>
          <div><label>Delivery<select id="order_delivery"><option>Yalidine Office</option><option>Home</option></select></label></div>
        </div>
        <button id="addOrderBtn">Add Order</button>
      </div>
      <div class="card">
        <h2>Orders</h2>
        <table id="ordersTable"><thead><tr><th>Order ID</th><th>Date</th><th>Customer</th><th>Variety</th><th>Qty</th><th>Status</th></tr></thead><tbody></tbody></table>
      </div>
    </section>

    <section id="customers" class="tab" hidden>
      <div class="card">
        <h2>New Customer</h2>
        <div class="row">
          <div><label>Name<input id="cust_name"></label></div>
          <div><label>Phone<input id="cust_phone"></label></div>
          <div><label>Address<textarea id="cust_addr" rows="2"></textarea></label></div>
        </div>
        <button id="addCustomerBtn">Add Customer</button>
      </div>
      <div class="card">
        <h2>Customers</h2>
        <table id="customersTable"><thead><tr><th>ID</th><th>Name</th><th>Phone</th><th>City</th></tr></thead><tbody></tbody></table>
      </div>
    </section>

    <section id="analytics" class="tab" hidden>
      <div class="grid">
        <div class="card">
          <h2>Rooting Success by Method</h2>
          <canvas id="rootingChart" height="160"></canvas>
        </div>
        <div class="card">
          <h2>Top Varieties (Orders)</hhed>
          <canvas id="varietiesChart" height="160"></canvas>
        </div>
        <div class="card">
          <h2>Returns & Delivery</h2>
          <canvas id="returnsChart" height="160"></canvas>
        </div>
      </div>
    </section>

    <section id="settings" class="tab" hidden>
      <div class="card">
        <h2>Repository & Token</h2>
        <div class="row">
          <div><label>Owner<input id="repo_owner" placeholder="your-github-username"></label></div>
          <div><label>Repo<input id="repo_name" placeholder="your-repo-name"></label></div>
          <div><label>Branch<input id="repo_branch" value="main"></label></div>
        </div>
        <label>GitHub Fine-Grained Token (repo:contents)<input id="gh_token" type="password" placeholder="paste token (stored locally)"></label>
        <p class="hint">Token is stored only in your device (localStorage). The app writes JSONL files via GitHub API (<code>PUT /contents</code>).</p>
        <button id="saveRepoBtn">Save Settings</button>
        <button id="syncAllBtn">Sync Now</button>
      </div>
      <div class="card">
        <h2>Export / Import</h2>
        <button id="exportBtn">Export All (json)</button>
        <input type="file" id="importFile" accept=".json" />
        <p class="hint">Data format is portable JSONL under /data â€” usable by any other app.</p>
      </div>
    </section>
  </main>

  <footer>Â© Fig Ops â€” static, local-first, GitHub-synced â€¢ Charting via Chart.js â€¢ PWA enabled</footer>

  <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
  <script type="module" src="modules/app.js"></script>
</body>
</html>
